<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> js中的匿名函数 · hammer's blog</title><meta name="description" content="js中的匿名函数 - hammer"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="hammer's blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">js中的匿名函数</h1><div class="post-info">Jan 6, 2018</div><div class="post-content"><h2 id="线索"><a href="#线索" class="headerlink" title="线索"></a>线索</h2><p>今天在看webpack打包成的bundle.js时发现这种写法<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;()</span><br></pre></td></tr></table></figure></p>
<p>之前在一些流行的js插件库中也见过同样的写法，只是隐约知道是一种匿名的立即执行函数，但具体作用原理并不是特别理解，于是上网找了些资料，试图尽量明白其作用原理。<br><a id="more"></a></p>
<h2 id="变量声明与表达式"><a href="#变量声明与表达式" class="headerlink" title="变量声明与表达式"></a>变量声明与表达式</h2><h3 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h3><p>多数编程语言中，变量都得声明后方可调用。常见的变量声明如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"><span class="keyword">let</span> a;</span><br><span class="line"><span class="keyword">const</span> a;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    &lt;!--TODO--&gt;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span>()</span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(height, width) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">'Bar'</span>;</span><br><span class="line">    <span class="keyword">this</span>.height = height;</span><br><span class="line">    <span class="keyword">this</span>.width = width;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><em>当然es2015中还有一些新的声明方式，诸如function</em>,async function等*</p>
<p>但js作用一门“灵活的”语言，它的声明规则有一些区别于其他语言的quirk。比如它有一个声明提升（Hoisting）的默认规则。这意味着以下代码并不会出现“变量未声明”这种报错。</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a)</span><br><span class="line"><span class="built_in">console</span>.log(b)</span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'hello world'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  environment:window7 chrome62</span><br><span class="line">  &gt;&gt;<span class="literal">undefined</span></span><br><span class="line">  &gt;&gt;ƒ b()&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'hello world'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  语法解释器会在解析代码前，将所有通过var关键字声明的变量预先提取，可以理解为这时候的代码变更为如下顺序<br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">'hello world'</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a) </span><br><span class="line"><span class="built_in">console</span>.log(b) </span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果变量a与函数名同名，此时函数的优先级更高。</p>
<h3 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h3><p>表达式与声明不一样的地方在于，表达式是由运算符构成，并能产生运算结果，例子如下</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="built_in">console</span>.log(a)</span><br><span class="line"><span class="built_in">console</span>.log(b)</span><br><span class="line">b()</span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> a=<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> b = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'hello world'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  environment:window7 chrome62</span><br><span class="line">  &gt;&gt;<span class="literal">undefined</span></span><br><span class="line">  &gt;&gt;<span class="literal">undefined</span></span><br><span class="line">  &gt;&gt;Uncaught <span class="built_in">TypeError</span>: funcName is not a <span class="function"><span class="keyword">function</span></span></span><br></pre></td></tr></table></figure>
<p> 如果给普通的声明前面加上赋值符号，就形成了一个表达式。在声明提升的过程中只提升变量的声明，并不会对变量的赋值运算做提升。只有代码执行到表达式这行时才进行赋值操作。这也就不难解释上述a与b的输出均为undefined。</p>
<h2 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h2><p>  要回答本文开头的那个疑惑，不得不提匿名函数。顾名思义，匿名函数就是没有函数名的函数。<br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'this is an anonymous function'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>既然是匿名的，那么该如何去调用它呢？一种方式是将匿名函数赋值给一个变量后再调用，另一种方式即通过自执行函数。常见的几种匿名自执行函数写法如下：</p>
<ul>
<li>( function(){}() )</li>
<li>( function(){} )()</li>
<li>! funcion(){}()</li>
<li>+function(){}()</li>
<li>var foo = function(){}()</li>
</ul>
<p>有时候我会将匿名函数写成这种形式，<strong><em>“ function(){}() ”</em></strong> 然后发现浏览器就会报错，那么为什么上面几个加了（）,！, +的就不会报错呢，根本原因是这几个运算符改变了解析器对代码的语法分析，将语句变为表达式，而表达式后面加括号该表达式会立即执行。前文说过声明语句与表达式的区别就是后者由运算符构成，并能产生一个值。所以不单是+，！，（），前面加上别的合法运算符如++，–，~等都可以让解析器成功解析成立即自执行函数。这里面的合法意味着不能加*，&amp;&amp;，/等，因为这些是二元运算符，需要两个运算对象。</p>
<h2 id="为什么使用匿名函数"><a href="#为什么使用匿名函数" class="headerlink" title="为什么使用匿名函数"></a>为什么使用匿名函数</h2><p>问题是哪些情况下适合用匿名自执行函数呢?</p>
<ul>
<li>当我们不希望自己代码的变量污染全局变量时使用匿名自执行函数就是一种很好的策略。所以很多js模块都会使用匿名立即自执行函数的形式以避免自己的变量与其余js模块的命名冲突。</li>
<li>当我们希望某个变量存储的值不是函数本身而是函数返回值时。</li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2018/02/09/webpack4新特性/" class="prev">PREV</a><a href="/2017/12/23/从浏览器地址栏输入一串url到页面呈现这个过程中发生了什么？/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 - 2018 <a href="http://yoursite.com">hammer</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>